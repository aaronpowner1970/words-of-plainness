<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TODO: Update meta description for this chapter -->
    <meta name="description" content="Chapter [XX]: [CHAPTER_TITLE] - Words of Plainness by Brother Aaron Powner">
    <!-- TODO: Update title for this chapter -->
    <title>Chapter [XX]: [CHAPTER_TITLE] | Words of Plainness</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=Source+Sans+Pro:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%23C4943A'/></svg>">
    <link rel="stylesheet" href="../../css/styles.css?v=3">
    <style>
        /* Base layout - ensure proper centering */
        html, body {
            width: 100%;
            overflow-x: hidden;
        }

        main {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        main > section,
        main > article,
        main > div {
            width: 100%;
        }

        /* Chapter-specific styles */
        .chapter-header {
            padding: calc(80px + var(--space-xl)) var(--space-xl) var(--space-lg);
            background:
                linear-gradient(to bottom, rgba(26, 21, 16, 0.55) 0%, rgba(61, 43, 31, 0.6) 100%),
                url('../../assets/images/library-empty.png') center center / cover no-repeat;
            text-align: center;
        }

        .chapter-number {
            font-family: var(--font-serif);
            font-size: 1rem;
            color: var(--gold-primary);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .chapter-title {
            font-family: var(--font-serif);
            font-size: clamp(2rem, 4vw, 3rem);
            color: var(--cream-soft);
            margin-bottom: 1rem;
        }

        .chapter-scripture {
            font-family: var(--font-serif);
            font-style: italic;
            font-size: 1.1rem;
            color: var(--cream);
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .chapter-scripture cite {
            display: block;
            margin-top: 0.5rem;
            font-style: normal;
            font-size: 0.95rem;
            color: var(--gold-primary);
        }

        /* Audio Player Bar - Sticky */
        .audio-player-bar {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 2rem);
            max-width: 900px;
            z-index: 1000;
            background: var(--brown-rich);
            border: 2px solid var(--gold-primary);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        body.player-active {
            padding-bottom: 80px;
        }

        .audio-player-bar.hidden {
            display: none;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .player-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gold-primary);
            color: var(--brown-deep);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s ease;
        }

        .player-btn:hover {
            background: var(--gold-light);
            transform: scale(1.05);
        }

        .player-btn.small {
            width: 32px;
            height: 32px;
            font-size: 0.9rem;
            background: transparent;
            color: var(--cream);
            border: 1px solid rgba(232, 220, 196, 0.3);
        }

        .player-btn.small:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        .progress-container {
            flex: 1;
            min-width: 150px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(232, 220, 196, 0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: var(--gold-primary);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .progress-bar:hover .progress-fill {
            background: var(--gold-light);
        }

        .time-display {
            font-size: 0.85rem;
            color: var(--cream);
            opacity: 0.8;
            min-width: 90px;
            text-align: center;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .speed-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            background: transparent;
            color: var(--cream);
            border: 1px solid rgba(232, 220, 196, 0.2);
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .speed-btn:hover, .speed-btn.active {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        .autoscroll-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--cream);
            cursor: pointer;
        }

        .autoscroll-toggle input {
            accent-color: var(--gold-primary);
        }

        /* Primary Actions */
        .primary-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            padding: var(--space-lg) var(--space-md);
            background: var(--brown-rich);
            border-bottom: 1px solid rgba(196, 148, 58, 0.15);
            flex-wrap: wrap;
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.9rem 1.8rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            font-size: 1rem;
            text-decoration: none;
            transition: all var(--transition-normal);
            cursor: pointer;
            border: none;
        }

        .action-btn-primary {
            background: var(--gold-primary);
            color: var(--brown-deep);
        }

        .action-btn-primary:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(196, 148, 58, 0.3);
        }

        .action-btn-secondary {
            background: transparent;
            color: var(--cream);
            border: 2px solid var(--cream);
        }

        .action-btn-secondary:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
            background: rgba(196, 148, 58, 0.1);
        }

        .action-icon {
            font-size: 1.1rem;
        }

        /* Quick Navigation Bar */
        .chapter-quick-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem var(--space-md);
            background: var(--brown-deep);
            border-bottom: 1px solid rgba(196, 148, 58, 0.15);
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .reading-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--cream);
            opacity: 0.7;
        }

        .reading-time {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .section-count {
            padding-left: 1rem;
            border-left: 1px solid rgba(232, 220, 196, 0.3);
        }

        .quick-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-links-label {
            font-size: 0.8rem;
            color: var(--cream);
            opacity: 0.6;
            margin-right: 0.25rem;
        }

        .quick-links a {
            padding: 0.35rem 0.75rem;
            font-size: 0.85rem;
            color: var(--gold-primary);
            background: rgba(196, 148, 58, 0.1);
            border: 1px solid rgba(196, 148, 58, 0.25);
            border-radius: 20px;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .quick-links a:hover {
            background: rgba(196, 148, 58, 0.2);
            border-color: var(--gold-primary);
        }

        /* Reading Progress Bar */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(26, 21, 16, 0.9);
            z-index: 1001;
        }

        .reading-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-light));
            width: 0%;
            transition: width 0.15s ease-out;
            box-shadow: 0 0 8px rgba(196, 148, 58, 0.5);
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 48px;
            height: 48px;
            background: var(--gold-primary);
            color: var(--brown-deep);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--gold-light);
            transform: translateY(-3px);
        }

        /* Table of Contents Sidebar */
        .toc-toggle {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--brown-rich);
            border: 1px solid rgba(196, 148, 58, 0.3);
            border-left: none;
            border-radius: 0 8px 8px 0;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            z-index: 100;
            color: var(--gold-primary);
            font-size: 0.75rem;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transition: all 0.3s ease;
        }

        .toc-toggle:hover {
            background: var(--brown-deep);
            padding-right: 0.75rem;
        }

        .toc-sidebar {
            position: fixed;
            left: -320px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: var(--brown-rich);
            border-right: 1px solid rgba(196, 148, 58, 0.3);
            z-index: 200;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 80px 0 2rem 0;
        }

        .toc-sidebar.open {
            left: 0;
        }

        .toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.25rem 1rem 1.25rem;
            border-bottom: 1px solid rgba(196, 148, 58, 0.2);
            margin-bottom: 1rem;
        }

        .toc-header h3 {
            font-family: var(--font-serif);
            font-size: 1rem;
            color: var(--gold-primary);
            margin: 0;
        }

        .toc-close {
            background: none;
            border: none;
            color: var(--cream);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .toc-close:hover {
            opacity: 1;
        }

        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-list li {
            margin: 0;
        }

        .toc-list a {
            display: block;
            padding: 0.6rem 1.25rem;
            color: var(--cream);
            text-decoration: none;
            font-size: 0.9rem;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .toc-list a:hover {
            background: rgba(196, 148, 58, 0.1);
            border-left-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        .toc-list a.active {
            background: rgba(196, 148, 58, 0.15);
            border-left-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        .toc-list .toc-subheading {
            padding-left: 2rem;
            font-size: 0.85rem;
            opacity: 0.85;
        }

        .toc-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .toc-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        /* Reader Toolbar (Font Size, Bookmark, Share) */
        .reader-toolbar {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(45, 32, 22, 0.95);
            border-radius: 30px;
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(196, 148, 58, 0.2);
        }

        .toolbar-group {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: rgba(196, 148, 58, 0.3);
        }

        .toolbar-btn {
            background: none;
            border: none;
            color: var(--cream);
            cursor: pointer;
            padding: 0.4rem 0.6rem;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .toolbar-btn:hover {
            background: rgba(196, 148, 58, 0.2);
            color: var(--gold-primary);
        }

        .toolbar-btn.active {
            background: rgba(196, 148, 58, 0.25);
            color: var(--gold-primary);
        }

        /* Font Size Controls */
        .font-btn {
            font-weight: 600;
            min-width: 32px;
            text-align: center;
        }

        .font-btn.small { font-size: 0.8rem; }
        .font-btn.medium { font-size: 1rem; }
        .font-btn.large { font-size: 1.2rem; }

        /* Bookmark Button */
        .bookmark-btn.bookmarked {
            color: var(--gold-primary);
        }

        .bookmark-btn .bookmark-icon {
            font-size: 1.1rem;
        }

        /* Share Dropdown */
        .share-container {
            position: relative;
        }

        .share-dropdown {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--brown-rich);
            border: 1px solid rgba(196, 148, 58, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            min-width: 160px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .share-dropdown.open {
            opacity: 1;
            visibility: visible;
        }

        .share-dropdown a,
        .share-dropdown button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem 0.75rem;
            color: var(--cream);
            text-decoration: none;
            font-size: 0.85rem;
            background: none;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            text-align: left;
        }

        .share-dropdown a:hover,
        .share-dropdown button:hover {
            background: rgba(196, 148, 58, 0.15);
        }

        .share-dropdown .share-icon {
            font-size: 1rem;
            width: 20px;
            text-align: center;
        }

        .copy-success {
            color: var(--gold-primary);
            font-size: 0.8rem;
            padding: 0.5rem;
            text-align: center;
        }

        /* Bookmark Resume Banner */
        .bookmark-banner {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--brown-rich);
            border: 1px solid var(--gold-primary);
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 150;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .bookmark-banner.show {
            opacity: 1;
            visibility: visible;
        }

        .bookmark-banner p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--cream);
        }

        .bookmark-banner button {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .bookmark-banner .resume-btn {
            background: var(--gold-primary);
            color: var(--brown-deep);
        }

        .bookmark-banner .dismiss-btn {
            background: transparent;
            color: var(--cream);
            border: 1px solid rgba(232, 220, 196, 0.3);
        }

        /* Chapter Content - Reading Area */
        .chapter-reading {
            max-width: 750px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-md);
            background: var(--brown-deep);
        }

        .chapter-reading h2 {
            font-family: var(--font-serif);
            font-size: 1.6rem;
            color: var(--gold-primary);
            margin: var(--space-xl) 0 var(--space-md) 0;
            padding-top: var(--space-md);
            border-top: 1px solid rgba(196, 148, 58, 0.2);
        }

        .chapter-reading h2:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .chapter-reading h3 {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            color: var(--cream);
            margin: var(--space-lg) 0 var(--space-sm) 0;
        }

        .chapter-reading p {
            font-size: 1.1rem;
            line-height: 1.9;
            margin-bottom: var(--space-md);
            color: var(--cream);
        }

        /* Sentence spans for highlighting */
        .sentence {
            transition: background-color 0.3s ease, color 0.3s ease;
            border-radius: 3px;
            padding: 0 2px;
            margin: 0 -2px;
            cursor: pointer;
        }

        .sentence:hover {
            background-color: rgba(196, 148, 58, 0.15);
        }

        .sentence.active {
            background-color: rgba(196, 148, 58, 0.35);
            color: var(--cream-soft);
        }

        .sentence.active:hover {
            background-color: rgba(196, 148, 58, 0.45);
        }

        .sentence.read {
            opacity: 0.7;
        }

        /* Study Resources Section */
        .section-title {
            font-family: var(--font-serif);
            font-size: 0.85rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold-primary);
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-xs);
            border-bottom: 1px solid rgba(196, 148, 58, 0.3);
        }

        .resource-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
        }

        .resource-card {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: rgba(45, 32, 22, 0.78);
            border: 1px solid rgba(196, 148, 58, 0.15);
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .resource-card:hover {
            border-color: var(--gold-primary);
            background: rgba(45, 32, 22, 0.95);
            transform: translateX(4px);
        }

        .resource-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background: rgba(196, 148, 58, 0.15);
            border-radius: 4px;
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .resource-info {
            flex: 1;
        }

        .resource-title {
            font-family: var(--font-serif);
            font-size: 1.1rem;
            color: var(--cream);
            margin-bottom: 0.2rem;
        }

        .resource-desc {
            font-size: 0.9rem;
            color: var(--cream);
            opacity: 0.7;
            margin: 0;
        }

        .resource-arrow {
            color: var(--gold-primary);
            font-size: 1.2rem;
            opacity: 0.7;
            transition: all 0.2s ease;
        }

        .resource-card:hover .resource-arrow {
            opacity: 1;
            transform: translateX(4px);
        }

        .resource-card.music {
            background: linear-gradient(135deg, rgba(107, 61, 61, 0.3) 0%, rgba(45, 32, 22, 0.78) 100%);
        }

        .resource-card.music .resource-icon {
            background: rgba(196, 148, 58, 0.25);
        }

        /* Content Sections */
        .chapter-content {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-md);
        }

        /* Reflection Section */
        .reflection-section {
            background: var(--brown-rich);
            padding: var(--space-xl) var(--space-md);
        }

        .reflection-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .reflection-card {
            background: linear-gradient(135deg, var(--brown-deep) 0%, rgba(45, 32, 22, 0.9) 100%);
            border: 1px solid rgba(196, 148, 58, 0.25);
            border-radius: 12px;
            padding: var(--space-lg);
        }

        .reflection-intro {
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .reflection-intro h3 {
            font-family: var(--font-serif);
            font-size: 1.4rem;
            color: var(--gold-primary);
            margin-bottom: 0.5rem;
        }

        .reflection-intro p {
            font-size: 0.95rem;
            opacity: 0.85;
            margin: 0;
        }

        .reflection-step {
            margin-bottom: var(--space-lg);
        }

        .reflection-step:last-of-type {
            margin-bottom: var(--space-md);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: 0.5rem;
        }

        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--gold-primary);
            color: var(--brown-deep);
            border-radius: 50%;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .step-title {
            font-family: var(--font-serif);
            font-size: 1.15rem;
            color: var(--cream);
        }

        .step-prompt {
            font-style: italic;
            font-size: 0.95rem;
            color: var(--cream);
            opacity: 0.85;
            margin-bottom: 0.75rem;
            padding-left: calc(28px + var(--space-sm));
        }

        .step-textarea {
            width: 100%;
            min-height: 100px;
            padding: var(--space-sm);
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(196, 148, 58, 0.2);
            border-radius: 4px;
            color: var(--cream);
            font-family: var(--font-sans);
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.2s ease;
        }

        .step-textarea:focus {
            outline: none;
            border-color: var(--gold-primary);
        }

        .step-textarea::placeholder {
            color: var(--cream);
            opacity: 0.5;
        }

        .reflection-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-md);
            padding-top: var(--space-sm);
            flex-wrap: wrap;
        }

        .reflection-note {
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.6;
            margin-top: var(--space-md);
        }

        /* Chapter Navigation */
        .chapter-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg) var(--space-md);
            background: var(--brown-rich);
            border-top: 1px solid rgba(196, 148, 58, 0.15);
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .chapter-nav-container {
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--cream);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s ease;
        }

        .nav-link:hover {
            color: var(--gold-primary);
        }

        .nav-link-label {
            font-size: 0.8rem;
            opacity: 0.6;
            display: block;
        }

        .nav-link-title {
            font-family: var(--font-serif);
        }

        .nav-prev {
            text-align: left;
        }

        .nav-next {
            text-align: right;
        }

        .nav-all {
            color: var(--gold-primary);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .chapter-header {
                padding: calc(70px + var(--space-lg)) var(--space-md) var(--space-md);
            }

            .chapter-quick-nav {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.75rem var(--space-md);
            }

            .reading-info {
                width: 100%;
                justify-content: flex-start;
            }

            .quick-links {
                width: 100%;
                justify-content: flex-start;
            }

            .quick-links-label {
                display: none;
            }

            .quick-links a {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }

            .back-to-top {
                bottom: 5rem;
                right: 1rem;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .toc-toggle {
                top: auto;
                bottom: 1rem;
                left: 1rem;
                transform: none;
                writing-mode: horizontal-tb;
                border-radius: 8px;
                border: 1px solid rgba(196, 148, 58, 0.3);
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }

            .toc-sidebar {
                width: 85%;
                max-width: 300px;
            }

            .reader-toolbar {
                bottom: 1rem;
                padding: 0.4rem 0.75rem;
                gap: 0.5rem;
                max-width: calc(100% - 6rem);
            }

            .toolbar-btn {
                padding: 0.3rem 0.5rem;
                font-size: 0.85rem;
            }

            .bookmark-banner {
                top: 70px;
                left: 1rem;
                right: 1rem;
                transform: none;
                flex-direction: column;
                gap: 0.75rem;
                text-align: center;
            }

            .audio-player-bar {
                bottom: 0.5rem;
                padding: 0.5rem;
                gap: 0.5rem;
                border-radius: 8px;
            }

            .progress-container {
                order: 10;
                width: 100%;
                min-width: 100%;
            }

            .speed-control {
                display: none;
            }

            .primary-actions {
                padding: var(--space-md);
            }

            .action-btn {
                padding: 0.8rem 1.4rem;
                font-size: 0.95rem;
                flex: 1;
                justify-content: center;
                min-width: 140px;
            }

            .chapter-reading {
                padding: var(--space-lg) var(--space-md);
            }

            .chapter-reading p {
                font-size: 1.05rem;
                line-height: 1.8;
            }

            .resource-card {
                padding: var(--space-sm) var(--space-md);
            }

            .resource-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .resource-title {
                font-size: 1rem;
            }

            .step-prompt {
                padding-left: 0;
                margin-top: 0.5rem;
            }

            .chapter-nav-container {
                flex-direction: column;
                gap: var(--space-md);
            }

            .nav-prev, .nav-next {
                text-align: center;
            }
        }

        /* Resource Modal Overlay */
        .resource-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .resource-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .resource-modal-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('../../assets/images/library-hero.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .resource-modal-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 21, 16, 0.88);
        }

        .resource-modal-content {
            position: relative;
            z-index: 1;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: var(--space-lg);
        }

        .resource-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(196, 148, 58, 0.3);
            margin-bottom: var(--space-lg);
        }

        .resource-modal-title {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            color: var(--gold-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .resource-modal-title .modal-icon {
            font-size: 1.75rem;
        }

        .resource-modal-close {
            background: rgba(196, 148, 58, 0.2);
            border: 1px solid rgba(196, 148, 58, 0.4);
            color: var(--cream);
            font-size: 1rem;
            padding: 0.6rem 1.25rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .resource-modal-close:hover {
            background: var(--gold-primary);
            color: var(--brown-deep);
            border-color: var(--gold-primary);
        }

        .resource-modal-body {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }

        /* Audio Player in Modal */
        .modal-audio-container {
            background: rgba(45, 32, 22, 0.95);
            border: 1px solid rgba(196, 148, 58, 0.3);
            border-radius: 12px;
            padding: var(--space-xl);
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-audio-icon {
            font-size: 4rem;
            margin-bottom: var(--space-md);
        }

        .modal-audio-title {
            font-family: var(--font-serif);
            font-size: 1.25rem;
            color: var(--cream);
            margin-bottom: 0.5rem;
        }

        .modal-audio-subtitle {
            font-size: 0.9rem;
            color: var(--cream);
            opacity: 0.7;
            margin-bottom: var(--space-lg);
        }

        .modal-audio-player {
            width: 100%;
            height: 50px;
            border-radius: 8px;
            margin-bottom: var(--space-md);
        }

        .modal-download-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.25rem;
            background: transparent;
            border: 1px solid rgba(196, 148, 58, 0.4);
            color: var(--gold-primary);
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .modal-download-btn:hover {
            background: rgba(196, 148, 58, 0.2);
            border-color: var(--gold-primary);
        }

        /* Image in Modal */
        .modal-image-container {
            max-width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .modal-image {
            max-width: 100%;
            max-height: 75vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-image-actions {
            margin-top: var(--space-md);
            display: flex;
            gap: 1rem;
        }

        /* Mobile Modal */
        @media (max-width: 768px) {
            .resource-modal-content {
                padding: var(--space-md);
            }

            .resource-modal-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .resource-modal-title {
                font-size: 1.2rem;
            }

            .resource-modal-close {
                width: 100%;
                justify-content: center;
            }

            .modal-audio-container {
                padding: var(--space-lg);
                margin: 0 var(--space-sm);
            }

            .modal-audio-icon {
                font-size: 3rem;
            }

            .modal-image {
                max-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <a href="../../index.html" class="logo">
                <span class="logo-title">WORDS OF PLAINNESS</span>
                <span class="logo-subtitle">A Christ-Centered Ministry</span>
            </a>

            <nav class="nav-desktop">
                <ul class="nav-links">
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../writings.html" class="active">Writings</a></li>
                    <li><a href="../discipleship.html">Discipleship</a></li>
                    <li><a href="../connect.html">Connect</a></li>
                    <li><a href="../about.html">About</a></li>
                </ul>
                <a href="../new-here.html" class="btn-new-here">New Here?</a>
            </nav>

            <button class="nav-toggle" aria-label="Toggle navigation menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" aria-label="Mobile navigation">
        <div class="mobile-menu-header">
            <div class="logo">
                <span class="logo-title">WORDS OF PLAINNESS</span>
                <span class="logo-subtitle">A Christ-Centered Ministry</span>
            </div>
            <button class="mobile-menu-close" aria-label="Close menu">x</button>
        </div>
        <a href="../new-here.html" class="mobile-menu-new-here">New Here? Start Here</a>
        <ul class="mobile-nav-list">
            <li><a href="../../index.html">Home</a></li>
            <li><a href="../writings.html">Writings</a></li>
            <li><a href="../discipleship.html">Discipleship</a></li>
            <li><a href="../connect.html">Connect</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../channels.html">Other Channels</a></li>
        </ul>
    </nav>

    <!-- Table of Contents Toggle -->
    <button class="toc-toggle" id="tocToggle" aria-label="Open table of contents">
        Contents
    </button>

    <!-- Table of Contents Overlay -->
    <div class="toc-overlay" id="tocOverlay"></div>

    <!-- Table of Contents Sidebar -->
    <!-- TODO: Update TOC entries for this chapter -->
    <aside class="toc-sidebar" id="tocSidebar">
        <div class="toc-header">
            <h3>Chapter Contents</h3>
            <button class="toc-close" id="tocClose" aria-label="Close table of contents">x</button>
        </div>
        <ul class="toc-list">
            <!-- TODO: Add section links for this chapter -->
            <li><a href="#section-1">[SECTION_1_TITLE]</a></li>
            <li><a href="#section-2">[SECTION_2_TITLE]</a></li>
            <li><a href="#section-3">[SECTION_3_TITLE]</a></li>
            <!-- Add more sections as needed -->
        </ul>
    </aside>

    <!-- Bookmark Resume Banner -->
    <div class="bookmark-banner" id="bookmarkBanner">
        <p>You left off at: <strong id="bookmarkLocation"></strong></p>
        <div class="banner-buttons">
            <button class="resume-btn" onclick="resumeFromBookmark()">Resume Reading</button>
            <button class="dismiss-btn" onclick="dismissBookmark()">Dismiss</button>
        </div>
    </div>

    <!-- Reading Progress Bar -->
    <div class="reading-progress">
        <div class="reading-progress-fill" id="readingProgress"></div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Chapter Header -->
        <!-- TODO: Update chapter number, title, and scripture -->
        <section class="chapter-header">
            <p class="chapter-number">Chapter [XX]</p>
            <h1 class="chapter-title">[CHAPTER_TITLE]</h1>
            <blockquote class="chapter-scripture">
                "[OPENING_SCRIPTURE_TEXT]"
                <cite>- [SCRIPTURE_REFERENCE]</cite>
            </blockquote>
        </section>

        <!-- Primary Actions -->
        <!-- TODO: Update PDF path for this chapter -->
        <div class="primary-actions">
            <button class="action-btn action-btn-primary" id="listenBtn" onclick="toggleAudioPlayer()">
                <span class="action-icon">Listen</span>
                <span id="listenBtnText">Listen to Chapter</span>
            </button>
            <a href="../../assets/pdf/WoP_Ch[XX]_[CHAPTER_SLUG].pdf" class="action-btn action-btn-secondary" download>
                <span class="action-icon">PDF</span>
                Download PDF
            </a>
        </div>

        <!-- Quick Navigation & Reading Info -->
        <!-- TODO: Update reading time and section count -->
        <div class="chapter-quick-nav">
            <div class="reading-info">
                <span class="reading-time">~[XX] min read</span>
                <span class="section-count">[XX] sections</span>
            </div>
            <nav class="quick-links" aria-label="Jump to section">
                <span class="quick-links-label">Jump to:</span>
                <a href="#chapterContent">Read Chapter</a>
                <a href="#study-resources">Study Resources</a>
                <a href="#reflection">Reflection</a>
                <a href="#discussion">Discussion</a>
            </nav>
        </div>

        <!-- Audio Player Bar (Hidden by default, shown when Listen is clicked) -->
        <div class="audio-player-bar hidden" id="audioPlayerBar">
            <div class="player-controls">
                <button class="player-btn" id="playPauseBtn" onclick="togglePlayPause()" aria-label="Play/Pause">
                    Play
                </button>
                <button class="player-btn small" onclick="skipBack()" aria-label="Back 10 seconds">
                    -10s
                </button>
                <button class="player-btn small" onclick="skipForward()" aria-label="Forward 10 seconds">
                    +10s
                </button>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" onclick="seekAudio(event)">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="time-display" id="timeDisplay">0:00 / 0:00</span>
            </div>

            <div class="speed-control">
                <button class="speed-btn" onclick="setSpeed(0.75)">0.75x</button>
                <button class="speed-btn active" onclick="setSpeed(1)">1x</button>
                <button class="speed-btn" onclick="setSpeed(1.25)">1.25x</button>
                <button class="speed-btn" onclick="setSpeed(1.5)">1.5x</button>
            </div>

            <label class="autoscroll-toggle">
                <input type="checkbox" id="autoscrollToggle" checked>
                Auto-scroll
            </label>
        </div>

        <!-- Chapter Reading Content -->
        <!-- TODO: Add chapter content with sentence spans for audio sync -->
        <article class="chapter-reading chapter-content" id="chapterContent">

            <!-- Example section structure - repeat for each section -->
            <h2 id="section-1">[SECTION_1_TITLE]</h2>

            <p>
                <span class="sentence" data-index="0">[First sentence of the chapter.]</span>
                <span class="sentence" data-index="1">[Second sentence of the chapter.]</span>
                <span class="sentence" data-index="2">[Third sentence.]</span>
            </p>

            <p>
                <span class="sentence" data-index="3">[Fourth sentence.]</span>
                <span class="sentence" data-index="4">[Fifth sentence.]</span>
            </p>

            <h2 id="section-2">[SECTION_2_TITLE]</h2>

            <p>
                <span class="sentence" data-index="5">[Continue with more sentences...]</span>
            </p>

            <!-- TODO: Add all chapter content with sentence spans -->

        </article>

        <!-- Study Resources -->
        <!-- TODO: Update resource paths for this chapter -->
        <section class="chapter-content" id="study-resources">
            <h2 class="section-title">Study Resources</h2>

            <div class="resource-list">
                <!-- Audio Narration -->
                <a href="#" class="resource-card"
                   data-modal="audio"
                   data-src="../../assets/audio/chapter-[XX]-narration.mp3"
                   data-title="Audio Narration"
                   data-subtitle="Full chapter read aloud (~[XX] minutes)"
                   data-icon="Audio">
                    <div class="resource-icon">Audio</div>
                    <div class="resource-info">
                        <h3 class="resource-title">Audio Narration</h3>
                        <p class="resource-desc">Full chapter read aloud (~[XX] minutes)</p>
                    </div>
                    <span class="resource-arrow">-></span>
                </a>

                <!-- Musical Companion (if available) -->
                <a href="#" class="resource-card music"
                   data-modal="audio"
                   data-src="../../assets/audio/chapter-[XX]-hymn.mp3"
                   data-title="Musical Companion"
                   data-subtitle="[HYMN_TITLE] - [ARTIST_NAME]"
                   data-icon="Music">
                    <div class="resource-icon">Music</div>
                    <div class="resource-info">
                        <h3 class="resource-title">Musical Companion</h3>
                        <p class="resource-desc">[HYMN_TITLE] - [ARTIST_NAME]</p>
                    </div>
                    <span class="resource-arrow">-></span>
                </a>

                <!-- Infographic -->
                <a href="#" class="resource-card"
                   data-modal="image"
                   data-src="../../assets/images/WoP_Ch[XX]_[CHAPTER_SLUG]_Infographic.png"
                   data-title="Infographic Summary"
                   data-subtitle="Visual overview of key concepts"
                   data-icon="Image">
                    <div class="resource-icon">Image</div>
                    <div class="resource-info">
                        <h3 class="resource-title">Infographic Summary</h3>
                        <p class="resource-desc">Visual overview of key concepts</p>
                    </div>
                    <span class="resource-arrow">-></span>
                </a>

                <!-- Slides -->
                <a href="chapter-[XX]-slides.html" class="resource-card">
                    <div class="resource-icon">Slides</div>
                    <div class="resource-info">
                        <h3 class="resource-title">Slides for Group Study</h3>
                        <p class="resource-desc">[XX]-slide presentation for class or study group discussion</p>
                    </div>
                    <span class="resource-arrow">-></span>
                </a>
            </div>
        </section>

        <!-- Engage: Reflection Prompt -->
        <!-- TODO: Update reflection prompts specific to this chapter -->
        <section class="reflection-section" id="reflection">
            <div class="reflection-container">
                <h2 class="section-title">Engage</h2>

                <div class="reflection-card">
                    <div class="reflection-intro">
                        <h3>Personal Reflection</h3>
                        <p>Take a few moments to ponder and record your thoughts on this chapter's themes.</p>
                    </div>

                    <div class="reflection-step">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <h4 class="step-title">Assess: Where Am I?</h4>
                        </div>
                        <p class="step-prompt">[REFLECTION_PROMPT_1 - customized to this chapter's theme]</p>
                        <textarea class="step-textarea" placeholder="My current thoughts and feelings..."></textarea>
                    </div>

                    <div class="reflection-step">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <h4 class="step-title">Align: What Does God Want?</h4>
                        </div>
                        <p class="step-prompt">[REFLECTION_PROMPT_2 - customized to this chapter's theme]</p>
                        <textarea class="step-textarea" placeholder="What I feel the Spirit teaching me..."></textarea>
                    </div>

                    <div class="reflection-step">
                        <div class="step-header">
                            <span class="step-number">3</span>
                            <h4 class="step-title">Act: My Commitment</h4>
                        </div>
                        <p class="step-prompt">[REFLECTION_PROMPT_3 - customized to this chapter's theme]</p>
                        <textarea class="step-textarea" placeholder="One specific action I will take..."></textarea>
                    </div>

                    <div class="reflection-actions">
                        <button class="btn btn-primary" onclick="saveReflection()">Save My Reflection</button>
                        <button class="btn btn-secondary" onclick="clearReflection()">Clear</button>
                    </div>

                    <p class="reflection-note">Your reflections are saved locally in your browser and are not shared.</p>
                </div>
            </div>
        </section>

        <!-- Engage: Discord Discussion -->
        <section class="discord-discussion" id="discussion">
            <div class="discord-discussion-card">
                <div class="discord-discussion-header">
                    <h2>Join the Discussion</h2>
                    <span class="discord-badge">
                        <svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36-.698.772-1.362 1.225-1.993a.076.076 0 0 0-.041-.107 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.093.246-.198.373-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
                        Discord
                    </span>
                </div>
                <p class="discord-discussion-text">
                    Share your insights and questions about this chapter with fellow seekers and saints in our Discord community.
                </p>
                <a href="https://discord.gg/tNwADDjTRV" class="discord-btn" target="_blank" rel="noopener">
                    <svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.36-.698.772-1.362 1.225-1.993a.076.076 0 0 0-.041-.107 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128c.125-.093.246-.198.373-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
                    Join the Discussion
                </a>
            </div>
        </section>

        <!-- Chapter Navigation -->
        <!-- TODO: Update prev/next chapter links -->
        <nav class="chapter-nav">
            <div class="chapter-nav-container">
                <a href="chapter-[PREV_NUM]-[PREV_SLUG].html" class="nav-link nav-prev">
                    <span><-</span>
                    <div>
                        <span class="nav-link-label">Previous</span>
                        <span class="nav-link-title">Chapter [PREV_NUM]: [PREV_TITLE]</span>
                    </div>
                </a>

                <a href="../writings.html" class="nav-link nav-all">
                    All Chapters
                </a>

                <a href="chapter-[NEXT_NUM]-[NEXT_SLUG].html" class="nav-link nav-next">
                    <div>
                        <span class="nav-link-label">Next</span>
                        <span class="nav-link-title">Chapter [NEXT_NUM]: [NEXT_TITLE]</span>
                    </div>
                    <span>-></span>
                </a>
            </div>
        </nav>
    </main>

    <!-- Reader Toolbar -->
    <div class="reader-toolbar" id="readerToolbar">
        <!-- Font Size Controls -->
        <div class="toolbar-group">
            <button class="toolbar-btn font-btn small" onclick="setFontSize('small')" aria-label="Small text">A</button>
            <button class="toolbar-btn font-btn medium active" onclick="setFontSize('medium')" aria-label="Medium text">A</button>
            <button class="toolbar-btn font-btn large" onclick="setFontSize('large')" aria-label="Large text">A</button>
        </div>

        <div class="toolbar-divider"></div>

        <!-- Bookmark Button -->
        <button class="toolbar-btn bookmark-btn" id="bookmarkBtn" onclick="toggleBookmark()" aria-label="Bookmark this location">
            <span class="bookmark-icon">Bookmark</span>
            <span class="bookmark-text">Bookmark</span>
        </button>

        <div class="toolbar-divider"></div>

        <!-- Share Button -->
        <div class="share-container">
            <button class="toolbar-btn share-btn" onclick="toggleShareDropdown()" aria-label="Share this chapter">
                <span>Share</span>
                <span>Share</span>
            </button>
            <div class="share-dropdown" id="shareDropdown">
                <button onclick="copyLink()">
                    <span class="share-icon">Link</span>
                    <span>Copy Link</span>
                </button>
                <a href="#" id="shareFacebook" target="_blank" rel="noopener">
                    <span class="share-icon">f</span>
                    <span>Facebook</span>
                </a>
                <a href="#" id="shareTwitter" target="_blank" rel="noopener">
                    <span class="share-icon">X</span>
                    <span>X (Twitter)</span>
                </a>
                <a href="#" id="shareEmail">
                    <span class="share-icon">Email</span>
                    <span>Email</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">^</button>

    <!-- Resource Modal Overlay -->
    <div class="resource-modal" id="resourceModal">
        <div class="resource-modal-bg"></div>
        <div class="resource-modal-content">
            <header class="resource-modal-header">
                <h2 class="resource-modal-title">
                    <span class="modal-icon" id="modalIcon">Audio</span>
                    <span id="modalTitle">Resource Title</span>
                </h2>
                <button class="resource-modal-close" onclick="closeResourceModal()">
                    <- Back to Chapter
                </button>
            </header>
            <div class="resource-modal-body" id="modalBody">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-lantern"></div>
        <p class="footer-tagline">Where Seekers and Saints Find Common Ground</p>
        <p class="footer-name">Brother Aaron Powner</p>
        <div class="footer-links">
            <a href="../about.html#ai-disclosure">AI Disclosure</a>
            <a href="../connect.html#contact">Contact</a>
            <a href="../about.html#faq">FAQ</a>
        </div>
        <p class="footer-copyright">2026 Words of Plainness Ministry. All rights reserved.</p>
    </footer>

    <!-- Hidden audio element -->
    <!-- TODO: Update audio file path for this chapter -->
    <audio id="chapterAudio" preload="metadata">
        <source src="../../assets/audio/chapter-[XX]-narration.mp3" type="audio/mpeg">
    </audio>

    <script src="../../js/main.js"></script>
    <script>
        // =====================================================
        // CHAPTER CONFIGURATION
        // TODO: Update these values for each chapter
        // =====================================================

        const chapterId = 'chapter-[XX]-[CHAPTER_SLUG]';  // e.g., 'chapter-02-the-human-search'
        const chapterTitle = 'Chapter [XX]: [CHAPTER_TITLE]';

        // =====================================================
        // AUDIO PLAYER WITH TEXT SYNCHRONIZATION
        // =====================================================

        const audio = document.getElementById('chapterAudio');
        const playerBar = document.getElementById('audioPlayerBar');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressFill = document.getElementById('progressFill');
        const progressBar = document.getElementById('progressBar');
        const timeDisplay = document.getElementById('timeDisplay');
        const listenBtn = document.getElementById('listenBtn');
        const listenBtnText = document.getElementById('listenBtnText');
        const autoscrollToggle = document.getElementById('autoscrollToggle');

        let isPlaying = false;
        let currentSentenceIndex = -1;
        let audioNeedsRecovery = false;
        let lastKnownTime = 0;

        // =====================================================
        // AUDIO RECOVERY SYSTEM
        // Handles tab switching and audio interruptions
        // =====================================================

        function recoverAudio(targetTime, shouldPlay = false) {
            return new Promise((resolve, reject) => {
                console.log('Attempting audio recovery...');

                const seekTime = targetTime || lastKnownTime || 0;

                const onCanPlay = () => {
                    audio.removeEventListener('canplay', onCanPlay);
                    audio.removeEventListener('error', onError);

                    try {
                        audio.currentTime = seekTime;
                        audioNeedsRecovery = false;
                        console.log('Audio recovered, seeking to:', seekTime);

                        if (shouldPlay) {
                            audio.play().then(resolve).catch(reject);
                        } else {
                            resolve();
                        }
                    } catch (e) {
                        reject(e);
                    }
                };

                const onError = (e) => {
                    audio.removeEventListener('canplay', onCanPlay);
                    audio.removeEventListener('error', onError);
                    console.error('Audio recovery failed:', e);
                    reject(e);
                };

                audio.addEventListener('canplay', onCanPlay, { once: true });
                audio.addEventListener('error', onError, { once: true });

                audio.load();

                setTimeout(() => {
                    audio.removeEventListener('canplay', onCanPlay);
                    audio.removeEventListener('error', onError);
                    reject(new Error('Audio recovery timeout'));
                }, 5000);
            });
        }

        audio.addEventListener('error', (e) => {
            console.error('Audio error:', e);
            audioNeedsRecovery = true;
        });

        audio.addEventListener('timeupdate', () => {
            if (!isNaN(audio.currentTime) && audio.currentTime > 0) {
                lastKnownTime = audio.currentTime;
            }
        });

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                if (audio.error || audio.networkState === 3) {
                    console.log('Tab returned - audio may need recovery');
                    audioNeedsRecovery = true;
                }
            } else {
                if (!isNaN(audio.currentTime)) {
                    lastKnownTime = audio.currentTime;
                }
            }
        });

        // =====================================================
        // TIMESTAMP DATA
        // TODO: Generate timestamps using Whisper or similar tool
        // Format: array of { index, start, end } for each sentence
        // =====================================================

        const sentenceTimestamps = [
            // Example timestamps - replace with actual data
            { index: 0, start: 0.0, end: 3.0 },
            { index: 1, start: 3.5, end: 7.0 },
            { index: 2, start: 7.5, end: 11.0 },
            // Add more timestamps as needed...
        ];

        // =====================================================
        // PLAYER CONTROLS
        // =====================================================

        function toggleAudioPlayer() {
            if (playerBar.classList.contains('hidden')) {
                playerBar.classList.remove('hidden');
                document.body.classList.add('player-active');
                listenBtnText.textContent = 'Hide Player';
            } else {
                playerBar.classList.add('hidden');
                document.body.classList.remove('player-active');
                listenBtnText.textContent = 'Listen to Chapter';
                if (isPlaying) {
                    togglePlayPause();
                }
            }
        }

        function togglePlayPause() {
            if (isPlaying) {
                audio.pause();
                playPauseBtn.textContent = 'Play';
                isPlaying = false;
            } else {
                if (audioNeedsRecovery || audio.error || audio.readyState === 0) {
                    playPauseBtn.textContent = '...';
                    recoverAudio(lastKnownTime, true)
                        .then(() => {
                            playPauseBtn.textContent = 'Pause';
                            isPlaying = true;
                        })
                        .catch(e => {
                            console.error('Playback failed after recovery attempt:', e);
                            playPauseBtn.textContent = 'Play';
                            alert('Could not play audio. Please refresh the page and try again.');
                        });
                } else {
                    audio.play()
                        .then(() => {
                            playPauseBtn.textContent = 'Pause';
                            isPlaying = true;
                        })
                        .catch(e => {
                            console.log('Audio playback failed, attempting recovery:', e);
                            audioNeedsRecovery = true;
                            playPauseBtn.textContent = '...';
                            recoverAudio(lastKnownTime, true)
                                .then(() => {
                                    playPauseBtn.textContent = 'Pause';
                                    isPlaying = true;
                                })
                                .catch(err => {
                                    playPauseBtn.textContent = 'Play';
                                    alert('Could not play audio. Please refresh the page and try again.');
                                });
                        });
                }
            }
        }

        function skipBack() {
            audio.currentTime = Math.max(0, audio.currentTime - 10);
        }

        function skipForward() {
            audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
        }

        function setSpeed(speed) {
            audio.playbackRate = speed;
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === speed + 'x') {
                    btn.classList.add('active');
                }
            });
        }

        function seekAudio(event) {
            const rect = progressBar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // =====================================================
        // TEXT HIGHLIGHTING & AUTOSCROLL
        // =====================================================

        function highlightSentence(index) {
            document.querySelectorAll('.sentence.active').forEach(el => {
                el.classList.remove('active');
                el.classList.add('read');
            });

            const currentSentence = document.querySelector(`.sentence[data-index="${index}"]`);
            if (currentSentence) {
                currentSentence.classList.add('active');
                currentSentence.classList.remove('read');

                if (autoscrollToggle.checked) {
                    currentSentence.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }
        }

        function findCurrentSentence(currentTime) {
            for (let i = 0; i < sentenceTimestamps.length; i++) {
                const ts = sentenceTimestamps[i];
                if (currentTime >= ts.start && currentTime < ts.end) {
                    return ts.index;
                }
            }
            return -1;
        }

        // =====================================================
        // AUDIO EVENT LISTENERS
        // =====================================================

        audio.addEventListener('timeupdate', () => {
            const percent = (audio.currentTime / audio.duration) * 100;
            progressFill.style.width = percent + '%';

            timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;

            if (sentenceTimestamps.length > 0) {
                const sentenceIndex = findCurrentSentence(audio.currentTime);
                if (sentenceIndex !== currentSentenceIndex && sentenceIndex !== -1) {
                    currentSentenceIndex = sentenceIndex;
                    highlightSentence(sentenceIndex);
                }
            }
        });

        audio.addEventListener('ended', () => {
            playPauseBtn.textContent = 'Play';
            isPlaying = false;
            progressFill.style.width = '0%';
            currentSentenceIndex = -1;

            document.querySelectorAll('.sentence').forEach(el => {
                el.classList.remove('active', 'read');
            });
        });

        audio.addEventListener('loadedmetadata', () => {
            timeDisplay.textContent = `0:00 / ${formatTime(audio.duration)}`;
        });

        // =====================================================
        // CLICK-TO-SEEK: Click any sentence to jump to that point
        // =====================================================

        document.querySelectorAll('.sentence').forEach(sentence => {
            sentence.style.cursor = 'pointer';

            sentence.addEventListener('click', (e) => {
                const index = parseInt(sentence.dataset.index);
                const timestamp = sentenceTimestamps.find(ts => ts.index === index);

                if (timestamp) {
                    if (playerBar.classList.contains('hidden')) {
                        playerBar.classList.remove('hidden');
                        document.body.classList.add('player-active');
                        listenBtnText.textContent = 'Hide Player';
                    }

                    currentSentenceIndex = index;
                    highlightSentence(index);

                    if (isPlaying) {
                        audio.pause();
                        playPauseBtn.textContent = 'Play';
                        isPlaying = false;
                    }

                    const seekToTimestamp = () => {
                        try {
                            audio.currentTime = timestamp.start;
                            lastKnownTime = timestamp.start;
                            const percent = (audio.currentTime / audio.duration) * 100;
                            progressFill.style.width = percent + '%';
                            timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
                        } catch (err) {
                            console.log('Seek error:', err);
                        }
                    };

                    if (audioNeedsRecovery || audio.error || audio.readyState === 0) {
                        console.log('Audio needs recovery before seeking');
                        recoverAudio(timestamp.start, false)
                            .then(() => {
                                seekToTimestamp();
                            })
                            .catch(err => {
                                console.error('Recovery failed:', err);
                                audio.load();
                                audio.addEventListener('canplay', () => {
                                    seekToTimestamp();
                                }, { once: true });
                            });
                    } else if (audio.readyState >= 1) {
                        seekToTimestamp();
                    } else {
                        audio.addEventListener('loadedmetadata', seekToTimestamp, { once: true });
                        audio.load();
                    }
                }
            });
        });

        // =====================================================
        // TABLE OF CONTENTS SIDEBAR
        // =====================================================

        const tocToggle = document.getElementById('tocToggle');
        const tocSidebar = document.getElementById('tocSidebar');
        const tocOverlay = document.getElementById('tocOverlay');
        const tocClose = document.getElementById('tocClose');
        const tocLinks = document.querySelectorAll('.toc-list a');

        function openToc() {
            tocSidebar.classList.add('open');
            tocOverlay.classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeToc() {
            tocSidebar.classList.remove('open');
            tocOverlay.classList.remove('open');
            document.body.style.overflow = '';
        }

        tocToggle.addEventListener('click', openToc);
        tocClose.addEventListener('click', closeToc);
        tocOverlay.addEventListener('click', closeToc);

        tocLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                closeToc();
                const targetId = link.getAttribute('href').substring(1);
                const target = document.getElementById(targetId);
                if (target) {
                    setTimeout(() => {
                        const headerOffset = 80;
                        const elementPosition = target.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                    }, 300);
                }
            });
        });

        function updateActiveTocItem() {
            const sections = document.querySelectorAll('[id^="section-"]');
            let currentSection = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop - 150;
                if (window.pageYOffset >= sectionTop) {
                    currentSection = section.getAttribute('id');
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', updateActiveTocItem);

        // =====================================================
        // FONT SIZE CONTROLS
        // =====================================================

        const fontSizes = {
            small: { body: '1rem', lineHeight: '1.75' },
            medium: { body: '1.1rem', lineHeight: '1.9' },
            large: { body: '1.25rem', lineHeight: '2' }
        };

        function setFontSize(size) {
            const chapterReading = document.querySelector('.chapter-reading');
            const paragraphs = chapterReading.querySelectorAll('p');

            paragraphs.forEach(p => {
                p.style.fontSize = fontSizes[size].body;
                p.style.lineHeight = fontSizes[size].lineHeight;
            });

            document.querySelectorAll('.font-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.font-btn.${size}`).classList.add('active');

            localStorage.setItem('wop-font-size', size);
        }

        const savedFontSize = localStorage.getItem('wop-font-size');
        if (savedFontSize) {
            setFontSize(savedFontSize);
        }

        // =====================================================
        // BOOKMARK FEATURE
        // =====================================================

        const bookmarkBtn = document.getElementById('bookmarkBtn');
        const bookmarkBanner = document.getElementById('bookmarkBanner');
        const bookmarkLocation = document.getElementById('bookmarkLocation');
        let currentBookmark = null;

        function getCurrentSection() {
            const sections = document.querySelectorAll('[id^="section-"]');
            let currentSection = null;

            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 200) {
                    currentSection = {
                        id: section.getAttribute('id'),
                        title: section.textContent.trim()
                    };
                }
            });

            return currentSection;
        }

        function toggleBookmark() {
            const section = getCurrentSection();
            if (!section) return;

            const bookmarkData = {
                chapterId: chapterId,
                sectionId: section.id,
                sectionTitle: section.title,
                scrollPosition: window.pageYOffset,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('wop-bookmark', JSON.stringify(bookmarkData));

            bookmarkBtn.classList.add('bookmarked');
            bookmarkBtn.querySelector('.bookmark-text').textContent = 'Bookmarked!';

            setTimeout(() => {
                bookmarkBtn.querySelector('.bookmark-text').textContent = 'Bookmark';
            }, 2000);
        }

        function checkForBookmark() {
            const saved = localStorage.getItem('wop-bookmark');
            if (saved) {
                const bookmark = JSON.parse(saved);
                if (bookmark.chapterId === chapterId) {
                    currentBookmark = bookmark;
                    bookmarkLocation.textContent = bookmark.sectionTitle;
                    bookmarkBanner.classList.add('show');
                    bookmarkBtn.classList.add('bookmarked');
                }
            }
        }

        function resumeFromBookmark() {
            if (currentBookmark) {
                window.scrollTo({ top: currentBookmark.scrollPosition, behavior: 'smooth' });
                bookmarkBanner.classList.remove('show');
            }
        }

        function dismissBookmark() {
            bookmarkBanner.classList.remove('show');
        }

        setTimeout(checkForBookmark, 500);

        // =====================================================
        // SHARE FUNCTIONALITY
        // =====================================================

        const shareDropdown = document.getElementById('shareDropdown');
        const pageUrl = encodeURIComponent(window.location.href);
        const pageTitle = encodeURIComponent(chapterTitle + ' - Words of Plainness');

        document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
        document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`;
        document.getElementById('shareEmail').href = `mailto:?subject=${pageTitle}&body=I thought you might enjoy this: ${decodeURIComponent(pageUrl)}`;

        function toggleShareDropdown() {
            shareDropdown.classList.toggle('open');
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const dropdown = document.getElementById('shareDropdown');
                const originalContent = dropdown.innerHTML;
                dropdown.innerHTML = '<p class="copy-success">Link copied!</p>';
                setTimeout(() => {
                    dropdown.innerHTML = originalContent;
                    dropdown.querySelector('button').addEventListener('click', copyLink);
                }, 1500);
            });
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.share-container')) {
                shareDropdown.classList.remove('open');
            }
        });

        // =====================================================
        // READING PROGRESS & BACK TO TOP
        // =====================================================

        const readingProgress = document.getElementById('readingProgress');
        const backToTop = document.getElementById('backToTop');
        const chapterContent = document.getElementById('chapterContent');

        window.addEventListener('scroll', () => {
            const contentTop = chapterContent.offsetTop;
            const contentHeight = chapterContent.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollY = window.scrollY;

            const progress = Math.min(100, Math.max(0,
                ((scrollY - contentTop + windowHeight * 0.5) / contentHeight) * 100
            ));
            readingProgress.style.width = progress + '%';

            if (scrollY > 500) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.querySelectorAll('.quick-links a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const target = document.getElementById(targetId);
                if (target) {
                    const headerOffset = 120;
                    const elementPosition = target.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            });
        });

        // =====================================================
        // RESOURCE MODAL
        // =====================================================

        const resourceModal = document.getElementById('resourceModal');
        const modalIcon = document.getElementById('modalIcon');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        let currentAudio = null;

        document.querySelectorAll('.resource-card[data-modal]').forEach(card => {
            card.addEventListener('click', (e) => {
                e.preventDefault();
                const modalType = card.dataset.modal;
                const src = card.dataset.src;
                const title = card.dataset.title;
                const subtitle = card.dataset.subtitle;
                const icon = card.dataset.icon;

                openResourceModal(modalType, src, title, subtitle, icon);
            });
        });

        function openResourceModal(type, src, title, subtitle, icon) {
            modalIcon.textContent = icon;
            modalTitle.textContent = title;

            modalBody.innerHTML = '';

            if (type === 'audio') {
                modalBody.innerHTML = `
                    <div class="modal-audio-container">
                        <div class="modal-audio-icon">${icon}</div>
                        <h3 class="modal-audio-title">${title}</h3>
                        <p class="modal-audio-subtitle">${subtitle}</p>
                        <audio class="modal-audio-player" controls autoplay id="modalAudioPlayer">
                            <source src="${src}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                        <a href="${src}" class="modal-download-btn" download>
                            Download Audio
                        </a>
                    </div>
                `;
                currentAudio = document.getElementById('modalAudioPlayer');
            } else if (type === 'image') {
                modalBody.innerHTML = `
                    <div class="modal-image-container">
                        <img src="${src}" alt="${title}" class="modal-image">
                        <div class="modal-image-actions">
                            <a href="${src}" class="modal-download-btn" download>
                                Download Image
                            </a>
                            <a href="${src}" class="modal-download-btn" target="_blank">
                                Open Full Size
                            </a>
                        </div>
                    </div>
                `;
            }

            resourceModal.classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeResourceModal() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            resourceModal.classList.remove('open');
            document.body.style.overflow = '';
        }

        resourceModal.addEventListener('click', (e) => {
            if (e.target === resourceModal || e.target.classList.contains('resource-modal-bg')) {
                closeResourceModal();
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && resourceModal.classList.contains('open')) {
                closeResourceModal();
            }
        });

        // =====================================================
        // REFLECTION STORAGE
        // =====================================================

        document.addEventListener('DOMContentLoaded', function() {
            const saved = localStorage.getItem(`wop-reflection-${chapterId}`);
            if (saved) {
                const data = JSON.parse(saved);
                const textareas = document.querySelectorAll('.step-textarea');
                textareas[0].value = data.assess || '';
                textareas[1].value = data.align || '';
                textareas[2].value = data.act || '';
            }
        });

        function saveReflection() {
            const textareas = document.querySelectorAll('.step-textarea');
            const data = {
                assess: textareas[0].value,
                align: textareas[1].value,
                act: textareas[2].value,
                savedAt: new Date().toISOString()
            };
            localStorage.setItem(`wop-reflection-${chapterId}`, JSON.stringify(data));
            alert('Your reflection has been saved locally.');
        }

        function clearReflection() {
            if (confirm('Are you sure you want to clear your reflection?')) {
                const textareas = document.querySelectorAll('.step-textarea');
                textareas.forEach(ta => ta.value = '');
                localStorage.removeItem(`wop-reflection-${chapterId}`);
            }
        }

    </script>

    <!-- Scripture Hyperlink Generator -->
    <script src="../../js/scripture-linker.js"></script>
    <script>
        // Initialize scripture linker on chapter content only
        if (typeof ScriptureLinker !== 'undefined') {
            ScriptureLinker.init('.chapter-content');
        }
    </script>
</body>
</html>
